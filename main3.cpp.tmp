/* mbed Microcontroller Library
 * Copyright (c) 2019 ARM Limited
 * SPDX-License-Identifier: Apache-2.0
 */

#include "mbed.h"
using namespace std::chrono;

// Blinking rate in milliseconds
// #define BLINKING_RATE     500ms


#define TIMESTAMP1 200
#define TIMESTAMP2 500

InterruptIn button(BUTTON1);
DigitalOut led(LED1);

Ticker flipper;
char flag_change_t;
std::chrono::microseconds t; // time in ms


void handler_rise() { 
    flag_change_t = 1;
}

void flip() {
    led = !led;
}

int main()
{
    t = 2.0;
    flag_change_t = 0;
    button.rise(&handler_rise); 
    flipper.attach(&flip, t);
       

    // A voir si il est possible de mettre ceci dans handle_rise ??
    while (true) {

        if (flag_change_t) {
            flag_change_t = 0;
            flipper.detach();

            if (t == TIMESTAMP1) {
                t = TIMESTAMP2;
            else {
                t = TIMESTAMP1;
            }

            flipper.attach(flip, t);
        }
    }
}
